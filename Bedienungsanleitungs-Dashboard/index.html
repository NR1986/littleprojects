<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bedienungsanleitungen f√ºr die [Name]</title>
<style>
:root{
  --bg:#0b0f14;--panel:#121826;--muted:#8b9bb4;--text:#e6eefb;
  --brand:#6aa6ff;--chip:#1b2435;--chip-active:#223150;
  --border:#1a2333;--focus:#7bc3ff;--danger:#ff5a6b;
  --disabled-bg:#1b2435;--disabled-fg:#6f7a94;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,#0b0f14,#0b1119);color:var(--text)}
header{position:sticky;top:0;z-index:10;backdrop-filter:blur(8px);
  background:rgba(11,15,20,.7);border-bottom:1px solid var(--border)}
.wrap{max-width:1200px;margin:0 auto;padding:18px 20px}
.title{display:flex;gap:12px;align-items:center}
.logo{width:36px;height:36px;border-radius:10px;
  background:radial-gradient(circle at 30% 30%,#8ac4ff,#3767ff);
  box-shadow:0 0 20px rgba(106,166,255,.35)}
h1{font-size:20px;margin:0}
.muted{color:var(--muted)}
.tabs{display:flex;gap:8px;margin-top:14px}
.tab{appearance:none;border:1px solid var(--border);
  background:var(--chip);color:var(--text);padding:10px 14px;
  border-radius:12px;cursor:pointer;font-weight:600}
.tab.active{background:var(--chip-active);border-color:#2b3a56}
.toolbar{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
.btn{background:var(--brand);color:#08111f;border:none;
  padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;justify-content:center}
.btn.ghost{background:transparent;color:var(--text);
  border:1px solid var(--border)}
.btn.danger{background:var(--danger);color:#2b0505}
.search{flex:1;min-width:220px;display:flex;align-items:center;gap:10px;
  background:var(--panel);border:1px solid var(--border);
  border-radius:12px;padding:10px 12px}
.search input{flex:1;background:transparent;border:none;outline:none;
  color:var(--text);font-size:14px}
.content{max-width:1200px;margin:0 auto;padding:18px 20px}
.panels{display:grid;grid-template-columns:280px 1fr;gap:18px}
@media(max-width:980px){.panels{grid-template-columns:1fr}}
aside{background:var(--panel);border:1px solid var(--border);
  border-radius:14px;padding:16px}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{border:1px solid var(--border);background:var(--chip);
  color:var(--text);padding:8px 10px;border-radius:999px;
  font-size:13px;cursor:pointer}
.chip.active{background:var(--chip-active)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
.card{background:var(--panel);border:1px solid var(--border);
  border-radius:16px;padding:14px;display:flex;gap:12px;align-items:flex-start}
.pdficon{width:40px;height:48px;border-radius:8px;
  background:linear-gradient(180deg,#ff8484,#ff4141);
  display:flex;align-items:center;justify-content:center;
  font-weight:800;color:#2b0505;box-shadow:0 10px 20px rgba(255,65,65,.12)}
.card h3{font-size:15px;margin:0 0 6px 0;line-height:1.25}
.meta{color:var(--muted);font-size:12px}
.empty{border:1px dashed var(--border);
  background:rgba(18,24,38,.5);border-radius:16px;padding:20px;
  text-align:center;color:var(--muted)}
.hr{height:1px;background:var(--border);margin:12px 0}
.admin{display:none}
.admin.active{display:block}
.dropzone{border:2px dashed #2b3a56;background:#0f1522;border-radius:16px;
  padding:18px;text-align:center;color:var(--muted)}
.list{margin-top:14px;display:grid;gap:10px}
.row{display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:10px;
  align-items:center;background:var(--panel);border:1px solid var(--border);
  border-radius:12px;padding:10px}
@media(max-width:780px){.row{grid-template-columns:1fr}}
.row input{width:100%;background:#0f1522;border:1px solid var(--border);
  color:var(--text);border-radius:10px;padding:8px 10px}
.row .actions{display:flex;gap:8px;justify-content:flex-end}
.statusbar{max-width:1200px;margin:8px auto 16px; padding:8px 12px;
  color:var(--muted);font-size:12px;border-top:1px solid var(--border);
  display:flex;gap:10px;align-items:center;justify-content:flex-start}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="title">
      <div class="logo"></div>
      <div>
        <h1>Bedienungsanleitungen f√ºr die [Name]</h1>
        <div class="muted" style="font-size:13px">Version 1.5 ‚Äì 12.11.2025</div>
      </div>
    </div>
    <div class="tabs">
      <button id="tabView" class="tab active">üìò Anleitungen</button>
      <button id="tabAdmin" class="tab">‚öôÔ∏è Verwaltung</button>
    </div>
    <div class="toolbar" id="toolbarView">
      <div class="search"><input id="search" type="search" placeholder="Suchen..."></div>
    </div>
    <div class="toolbar" id="toolbarAdmin" style="display:none">
      <button id="exportBtn" class="btn ghost">Exportieren (JSON)</button>
      <button id="importBtn" class="btn ghost">Importieren (JSON)</button>
      <input id="importFile" type="file" accept="application/json" hidden>
    </div>
  </div>
</header>

<main class="content">
  <div id="viewPanel" class="panels">
    <aside>
      <strong>Kategorien</strong>
      <div id="chipList" class="chips"></div>
      <div class="hr"></div>
      <div class="muted" style="font-size:13px">Die Pfade m√ºssen auf PDFs im <code>files/</code>-Ordner zeigen.</div>
    </aside>
    <section>
      <div id="summary" class="muted">Keine Dateien geladen.</div>
      <div id="grid" class="grid"></div>
      <div id="empty" class="empty" style="display:none">Keine Treffer</div>
    </section>
  </div>

  <section id="adminPanel" class="admin">
    <div class="dropzone" id="dropzone">
      <strong>PDFs hierher ziehen</strong>
      <div class="muted" style="margin-top:6px">Nur Verweise werden gespeichert ‚Äì keine Dateien erstellt.</div>
      <input id="filePicker" type="file" accept="application/pdf" multiple hidden>
    </div>
    <div class="hr"></div>
    <h3>Gespeicherte Anleitungen</h3>
    <div id="adminList" class="list"></div>
    <datalist id="catList"></datalist>

    <div class="hr"></div>
    <h3>Statisches HTML erzeugen</h3>
    <div class="muted" style="font-size:13px;margin-bottom:8px">
      Wenn alle Titel/Kategorien/Pfade passen, kannst du unten fixen HTML-Code erzeugen.
    </div>
    <div class="toolbar" style="margin-top:6px">
      <button id="genHtmlBtn" class="btn">HTML-Code erzeugen</button>
      <button id="copyHtmlBtn" class="btn ghost">Code kopieren</button>
    </div>
    <textarea id="htmlOut" style="width:100%;height:220px;margin-top:10px;background:#0f1522;color:#e6eefb;border:1px solid var(--border);border-radius:12px;padding:10px" placeholder="Hier erscheint der erzeugte HTML-Code‚Ä¶"></textarea>
  </section>
</main>
<div class="statusbar" id="statusbar">‚Äî</div>

<script>
(function(){
  const $=q=>document.querySelector(q);
  const search=$('#search'),grid=$('#grid'),chipList=$('#chipList'),empty=$('#empty'),summary=$('#summary');
  const tabView=$('#tabView'),tabAdmin=$('#tabAdmin'),viewPanel=$('#viewPanel'),adminPanel=$('#adminPanel');
  const toolbarView=$('#toolbarView'),toolbarAdmin=$('#toolbarAdmin');
  const dropzone=$('#dropzone'),filePicker=$('#filePicker');
  const adminList=$('#adminList'),catList=$('#catList');
  const exportBtn=$('#exportBtn'),importBtn=$('#importBtn'),importFile=$('#importFile');
  const genHtmlBtn=$('#genHtmlBtn'),copyHtmlBtn=$('#copyHtmlBtn'),htmlOut=$('#htmlOut');
  const statusbar=$('#statusbar');

  const STORE_KEY='kantine_store_v5';
  let items=load(); let activeCategory='Alle'; let searchTerm='';

  tabView.onclick=()=>setTab(true);
  tabAdmin.onclick=()=>setTab(false);
  function setTab(v){tabView.classList.toggle('active',v);tabAdmin.classList.toggle('active',!v);
    viewPanel.style.display=v?'grid':'none';adminPanel.style.display=v?'none':'block';
    toolbarView.style.display=v?'flex':'none';toolbarAdmin.style.display=v?'none':'flex';
    if(!v)renderAdmin();}

  search.oninput=()=>{searchTerm=(search.value||'').toLowerCase();render();updateBars();};
  dropzone.onclick=()=>filePicker.click();
  filePicker.onchange=e=>handleFiles(e.target.files);

  function handleFiles(list){
    const files=[...list].filter(f=>/\.pdf$/i.test(f.name));
    if(!files.length)return;
    files.forEach(f=>{
      const id='drop:'+f.name+':'+(f.lastModified||0);
      const entry={id,name:f.name,title:generateTitle(f.name),category:'Allgemein',path:'files/'+f.name};
      const i=items.findIndex(x=>x.id===id);
      if(i>=0)items[i]=entry;else items.push(entry);
    });
    saveItems();
  }

  function render(){
    const f=items.filter(i=>(activeCategory==='Alle'||i.category===activeCategory)&&(i.title||'').toLowerCase().includes(searchTerm));
    grid.innerHTML='';
    if(!f.length){empty.style.display='block';summary.textContent='0 PDFs';return;}
    empty.style.display='none';
    f.sort((a,b)=>a.category.localeCompare(b.category)||a.title.localeCompare(b.title));
    f.forEach(it=>{
      const card=document.createElement('article');card.className='card';
      const icon=document.createElement('div');icon.className='pdficon';icon.textContent='PDF';
      const h3=document.createElement('h3');h3.textContent=it.title||it.name;
      const meta=document.createElement('div');meta.className='meta';meta.textContent=it.category||'';
      const btn=document.createElement('a');btn.className='btn';btn.textContent='√ñffnen';btn.href=it.path||'#';btn.target='_blank';btn.rel='noopener';
      const right=document.createElement('div');right.append(h3,meta,btn);card.append(icon,right);
      grid.append(card);
    });
    summary.textContent=f.length+' PDFs angezeigt';
  }

  function renderAdmin(){
    adminList.innerHTML='';
    if(!items.length){adminList.innerHTML='<div class="empty">Keine Eintr√§ge.</div>';return;}
    items.forEach((it,ix)=>{
      const row=document.createElement('div');row.className='row';
      const title=document.createElement('input');title.placeholder='Titel';title.value=it.title||'';
      const name=document.createElement('input');name.placeholder='Pfad (z. B. files/Ordner/A.pdf)';name.value=it.path||'';
      const cat=document.createElement('input');cat.setAttribute('list','catList');cat.placeholder='Kategorie';cat.value=it.category||'';
      const actions=document.createElement('div');actions.className='actions';
      const save=document.createElement('button');save.className='btn ghost';save.textContent='Speichern';
      const del=document.createElement('button');del.className='btn danger';del.textContent='L√∂schen';
      save.onclick=()=>{it.title=title.value.trim()||generateTitle(it.path||'');it.path=name.value.trim();it.category=cat.value.trim()||'Allgemein';saveItems();};
      del.onclick=()=>{if(confirm('L√∂schen?')){items.splice(ix,1);saveItems();}};
      actions.append(save,del);
      row.append(title,name,cat,actions);
      adminList.append(row);
    });
  }

  function buildChips(){
    const cats=[...new Set(items.map(i=>i.category))].filter(Boolean).sort((a,b)=>a.localeCompare(b));
    const all=['Alle',...cats];chipList.innerHTML='';
    all.forEach(c=>{const b=document.createElement('button');b.className='chip'+(c===activeCategory?' active':'');b.textContent=c;b.onclick=()=>{activeCategory=c;buildChips();render();updateBars();};chipList.append(b);});
    catList.innerHTML=cats.map(c=>`<option value="${escapeHtml(c)}">`).join('');
  }

  function generateTitle(n){return(n||'').replace(/\.pdf$/i,'').replace(/[-_]/g,' ').replace(/\s+/g,' ').replace(/(^|\s)\S/g,t=>t.toUpperCase()).trim();}
  function escapeHtml(s){return(s+'').replace(/[&<>\"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\'':'&#39;'}[c]));}
  function load(){try{const d=JSON.parse(localStorage.getItem(STORE_KEY)||'[]');return Array.isArray(d)?d:[];}catch{return[];}}
  function save(){localStorage.setItem(STORE_KEY,JSON.stringify(items));}
  function saveItems(){save();buildChips();renderAdmin();render();updateBars();}
  exportBtn.onclick=()=>{const blob=new Blob([JSON.stringify(items,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='kantine_data.json';a.click();};
  importBtn.onclick=()=>importFile.click();
  importFile.onchange=async e=>{const f=e.target.files?.[0];if(!f)return;try{const txt=await f.text();const data=JSON.parse(txt);if(Array.isArray(data)){items=data;saveItems();}else alert('Ung√ºltiges JSON.');}catch(err){alert('Import fehlgeschlagen: '+err.message);}};
  function updateBars(){const total=items.length,shown=grid.children.length,cats=new Set(items.map(i=>i.category));statusbar.textContent=`üìÅ ${total} Dateien ‚Ä¢ ${cats.size} Kategorien ‚Ä¢ ${shown} angezeigt`;}
  buildChips();render();updateBars();

  // üîÑ Auto-Load kantine_data.json beim ersten Start
  if(!localStorage.getItem(STORE_KEY)){
    fetch('kantine_data.json')
      .then(res=>res.ok?res.json():null)
      .then(data=>{
        if(Array.isArray(data)){
          items=data;
          saveItems();
          console.log('kantine_data.json geladen');
        }
      })
      .catch(err=>console.warn('Keine kantine_data.json gefunden:',err));
  }
})();
</script>
</body>
</html>
